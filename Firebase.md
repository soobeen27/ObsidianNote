
# Firestore 
> no SQL 기반 DB

![[Pasted image 20240904012336.png|300]]
![[Pasted image 20240904012457.png|300]]
콜렉션 안에는 문서만 들어가고 문서에는 데이터가 들어감 
데이터는 1mb까지 지원
### 참조
참조는 데이터베이스의 특정 위치를 가리키는 간단한 객체임.
```swift
let alovelaceDocumentRef = db.collection("users").document("alovelace")
```
`users` 콜렉션의 `alovelace`문서를 참조

물론 콜렉션을 가리키는 참조도 만들 수 있음
```swift
let usersCollectionRef = db.collection("users")
```

혹은 `/`로 구분한 문자열로 콜렉션이나 문서에 참조를 만들 수 있다.
```swift
let aLovelaceDocumentReference = db.document("users/alovelace")
```

**Firestore의 문서는 가벼워야한다**

> 만일 한개의 문서에 많은 데이터가 필요하다면 문서안에 하위 콜렉션을 생성하자

## 지원되는 데이터 유형(firestore)
| 데이터 유형   | 정렬 순서                             | 참고                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| -------- | --------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 배열       | 요소 값 기준                           | 한 배열이 다른 배열 값을 요소 중 하나로 포함할 수 없습니다.<br><br>한 배열 내에서 요소는 할당된 위치를 유지합니다. 배열을 여러 개 정렬하면 배열이 요소 값을 기준으로 정렬됩니다.<br><br>두 배열을 비교할 때는 각 배열의 첫 번째 요소가 비교됩니다. 첫 번째 요소가 같으면 그 다음 요소를 비교하는 식으로 차이가 발견될 때까지 이 과정이 반복됩니다. 배열에 비교할 요소가 더 이상 없으나 끝까지 요소가 동일하다면 길이가 짧은 배열이 긴 배열보다 먼저 정렬됩니다.<br><br>예를 들면 `[1, 2, 3] < [1, 2, 3, 1] < [2]`입니다. `[2]` 배열에 가장 큰 첫 번째 요소 값이 있습니다. `[1, 2, 3]` 배열은 `[1, 2, 3, 1]`의 처음 세 요소와 동일하지만 길이가 더 짧습니다.                                                                                                                                                                    |
| 부울       | `false` < `true`                  | —                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 바이트      | 바이트순                              | 최대 1,048,487바이트(1MiB에서 89바이트를 뺀 값)입니다. 쿼리에서 처음 1,500바이트만 고려됩니다.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 날짜 및 시간  | 시간순                               | Cloud Firestore에 저장된 경우, 마이크로초까지만 정확하며 그 이상의 정확도는 내림됩니다.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 부동 소수점 수 | 숫자                                | 64비트 배정밀도이며 [IEEE 754](https://en.wikipedia.org/wiki/IEEE_754)입니다.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 지리적 지점   | 위도순 우선 적용 후 경도순                   | 현재 쿼리 제한사항으로 인해 이 데이터 유형은 사용하지 않는 것이 좋습니다. 일반적으로 위도와 경도를 별도의 숫자 필드로 저장하는 것이 좋습니다. 앱에 간단한 거리 기반 지역 쿼리가 필요한 경우 [지역 쿼리](https://firebase.google.com/docs/firestore/solutions/geoqueries?hl=ko)를 참조하세요.                                                                                                                                                                                                                                                                                                                                                                                         |
| 정수       | 숫자                                | 64비트, 서명됨                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 맵        | 키 기준 우선 적용, 그 다음 값 기준 적용          | 문서 내에 삽입된 객체를 나타냅니다. 색인 처리하면 하위 필드를 쿼리할 수 있습니다. 이 값을 색인 처리에서 제외할 경우 하위 필드도 모두 색인 처리에서 제외됩니다.<br><br>키 순서는 항상 정렬됩니다. 예를 들어 `{c: "foo", a: "bar", b: "qux"}`를 작성하면 지도가 키를 기준으로 정렬되고 `{a: "bar", b: "qux", c: "foo"}`로 저장됩니다.<br><br>맵 필드는 키를 기준으로 정렬되고 키-값 쌍을 기준으로 비교됩니다. 먼저 키와 비교한 후 값으로 비교합니다. 첫 번째 키-값 쌍이 동일한 경우 다음 키-값 쌍이 비교되고 이것이 반복됩니다. 두 맵이 동일한 키-값 쌍으로 시작되는 경우 맵 길이가 고려됩니다. 예를 들어, 다음은 맵이 오름차순으로 정렬된 경우입니다.<br><br>`{a: "aaa", b: "baz"}`  <br>`{a: "foo", b: "bar"}`  <br>`{a: "foo", b: "bar", c: "qux"}`  <br>`{a: "foo", b: "baz"}`  <br>`{b: "aaa", c: "baz"}`  <br>`{c: "aaa"}` |
| NaN      | 없음                                | —                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Null     | 없음                                | —                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| 참조       | 경로 요소순(컬렉션, 문서 ID, 컬렉션, 문서 ID...) | 예를 들면 `projects/[PROJECT_ID]/databases/[DATABASE_ID]/documents/[DOCUMENT_PATH]`입니다.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 텍스트 문자열  | UTF-8로 인코딩된 바이트순                  | 최대 1,048,487바이트(1MiB에서 89바이트를 뺀 값)입니다. 쿼리에서 UTF-8로 표시된 처음 1,500바이트만 고려됩니다.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
[firestore docs](https://firebase.google.com/docs/firestore/manage-data/data-types?hl=ko)

## 데이터 구조 선택
https://firebase.google.com/docs/firestore/manage-data/structure-data?hl=ko

## 데이터 추가
```swift
// Add a new document in collection "cities"  
do {  try await db.collection("cities").document("LA").setData([    "name": "Los Angeles",    "state": "CA",    "country": "USA"  ])  print("Document successfully written!")  
} catch {  print("Error writing document: \(error)")  
}
```
문서가 없으면 생성되고 있다면 덮어씀

#### 머지
```swift
// Update one field, creating the document if it does not exist.  
db.collection("cities").document("BJ").setData([ "capital": true ], merge: true)
```
문서가 있는지 확실하지 않은 경우 전체 문서를 실수로 덮어쓰지 않도록 새 데이터를 기존 문서와 병합하는 옵션을 전달하세요. 맵이 포함된 문서의 경우 빈 맵이 있는 필드를 사용해 집합을 지정하면 대상 문서의 맵 필드를 덮어씁니다.